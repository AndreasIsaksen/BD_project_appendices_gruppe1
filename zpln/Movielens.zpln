{"paragraphs":[{"text":"// import av nødvendige funksjoner og lesing av dataset\r\nimport org.apache.spark.sql.types._\r\nimport org.apache.spark.sql.DataFrame\r\nimport org.apache.spark.sql.functions._\r\nimport scala.math._\r\nimport org.apache.spark.sql.expressions.Window\r\n\r\nval movies = spark.read\r\n    .format(\"csv\")\r\n    .option(\"header\", true)\r\n    .option(\"inferSchema\", true)\r\n    .load(\"/sparkio/ml-32m/movies.csv\")\r\n\r\nval ratings = spark.read\r\n    .format(\"csv\")\r\n    .option(\"header\", true)\r\n    .option(\"inferSchema\", true)\r\n    .load(\"/sparkio/ml-32m/ratings.csv\")\r\n\r\nval tags = spark.read\r\n    .format(\"csv\")\r\n    .option(\"header\", true)\r\n    .option(\"inferSchema\", true)\r\n    .load(\"/sparkio/ml-32m/tags.csv\")","user":"anonymous","dateUpdated":"2025-09-29T20:10:12+0000","progress":0,"config":{"colWidth":12,"fontSize":9,"results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.types._\nimport org.apache.spark.sql.DataFrame\nimport org.apache.spark.sql.functions._\nimport scala.math._\n\u001b[1m\u001b[34mmovies\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [movieId: int, title: string ... 1 more field]\n\u001b[1m\u001b[34mratings\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [userId: int, movieId: int ... 2 more fields]\n\u001b[1m\u001b[34mtags\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [userId: int, movieId: int ... 2 more fields]\n"}]},"apps":[],"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":[{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=0"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=1"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=2"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=3"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=4"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=5"}],"interpreterSettingId":"spark"}},"progressUpdateIntervalMs":500,"jobName":"paragraph_1758718958065_1928919993","id":"paragraph_1758651599899_1219238674","dateCreated":"2025-09-24T13:02:38+0000","dateStarted":"2025-09-29T17:35:44+0000","dateFinished":"2025-09-29T17:37:09+0000","status":"FINISHED","focus":false},{"text":"movies.show(5)\r\nratings.show(5)\r\ntags.show(5)\r\n\r\nprint(movies.count(), ratings.count(), tags.count())","user":"anonymous","dateUpdated":"2025-09-29T17:37:09+0000","progress":16,"config":{"colWidth":12,"fontSize":9,"results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+--------------------+--------------------+\n|movieId|               title|              genres|\n+-------+--------------------+--------------------+\n|      1|    Toy Story (1995)|Adventure|Animati...|\n|      2|      Jumanji (1995)|Adventure|Childre...|\n|      3|Grumpier Old Men ...|      Comedy|Romance|\n|      4|Waiting to Exhale...|Comedy|Drama|Romance|\n|      5|Father of the Bri...|              Comedy|\n+-------+--------------------+--------------------+\nonly showing top 5 rows\n\n+------+-------+------+---------+\n|userId|movieId|rating|timestamp|\n+------+-------+------+---------+\n|     1|     17|   4.0|944249077|\n|     1|     25|   1.0|944250228|\n|     1|     29|   2.0|943230976|\n|     1|     30|   5.0|944249077|\n|     1|     32|   5.0|943228858|\n+------+-------+------+---------+\nonly showing top 5 rows\n\n+------+-------+-----------+----------+\n|userId|movieId|        tag| timestamp|\n+------+-------+-----------+----------+\n|    22|  26479|Kevin Kline|1583038886|\n|    22|  79592|   misogyny|1581476297|\n|    22| 247150| acrophobia|1622483469|\n|    34|   2174|      music|1249808064|\n|    34|   2174|      weird|1249808102|\n+------+-------+-----------+----------+\nonly showing top 5 rows\n\n(87585,32000204,2000072)"}]},"apps":[],"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":[{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=6"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=7"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=8"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=9"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=10"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=11"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=12"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=13"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=14"}],"interpreterSettingId":"spark"}},"progressUpdateIntervalMs":500,"jobName":"paragraph_1758879441648_637952650","id":"paragraph_1758879441648_637952650","dateCreated":"2025-09-26T09:37:21+0000","dateStarted":"2025-09-29T17:37:09+0000","dateFinished":"2025-09-29T17:37:17+0000","status":"FINISHED"},{"text":"// Parse timestamps to rating_date\r\nval ratings_with_date = ratings\r\n    .withColumn(\"rating_date\", to_date(from_unixtime(col(\"timestamp\"))))\r\n    .drop(\"timestamp\")\r\n\r\nratings_with_date.show(5)\r\n","user":"anonymous","dateUpdated":"2025-09-29T17:37:17+0000","progress":0,"config":{"colWidth":12,"fontSize":9,"results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------+-------+------+-----------+\n|userId|movieId|rating|rating_date|\n+------+-------+------+-----------+\n|     1|     17|   4.0| 1999-12-03|\n|     1|     25|   1.0| 1999-12-03|\n|     1|     29|   2.0| 1999-11-22|\n|     1|     30|   5.0| 1999-12-03|\n|     1|     32|   5.0| 1999-11-22|\n+------+-------+------+-----------+\nonly showing top 5 rows\n\n\u001b[1m\u001b[34mratings_with_date\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [userId: int, movieId: int ... 2 more fields]\n"}]},"apps":[],"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":[{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=15"}],"interpreterSettingId":"spark"}},"progressUpdateIntervalMs":500,"jobName":"paragraph_1758879396825_2007171933","id":"paragraph_1758879396825_2007171933","dateCreated":"2025-09-26T09:36:36+0000","dateStarted":"2025-09-29T17:37:17+0000","dateFinished":"2025-09-29T17:37:18+0000","status":"FINISHED","focus":false},{"text":"// ratings per day\r\nval ratings_per_date = ratings_with_date\r\n    .groupBy(\"rating_date\")\r\n    .count()\r\n    .orderBy(desc(\"count\"))\r\n\r\nratings_per_date.show(5)","user":"anonymous","dateUpdated":"2025-09-29T17:37:18+0000","progress":0,"config":{"colWidth":12,"fontSize":9,"results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------+-----+\n|rating_date|count|\n+-----------+-----+\n| 2000-11-20|90717|\n| 2005-03-22|74922|\n| 1999-12-11|63064|\n| 2008-10-29|53629|\n| 2000-11-21|53514|\n+-----------+-----+\nonly showing top 5 rows\n\n\u001b[1m\u001b[34mratings_per_date\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [rating_date: date, count: bigint]\n"}]},"apps":[],"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":[{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=16"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=17"}],"interpreterSettingId":"spark"}},"progressUpdateIntervalMs":500,"jobName":"paragraph_1758879520703_46962867","id":"paragraph_1758879520703_46962867","dateCreated":"2025-09-26T09:38:40+0000","dateStarted":"2025-09-29T17:37:18+0000","dateFinished":"2025-09-29T17:37:39+0000","status":"FINISHED"},{"text":"// distribution of rating values\r\nval rating_distribution = ratings_with_date\r\n    .groupBy(\"rating\")\r\n    .count()\r\n    .orderBy(asc(\"rating\"))\r\n\r\nrating_distribution.show()","user":"anonymous","dateUpdated":"2025-09-29T17:37:39+0000","progress":100,"config":{"colWidth":12,"fontSize":9,"results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------+-------+\n|rating|  count|\n+------+-------+\n|   0.5| 525132|\n|   1.0| 946675|\n|   1.5| 531063|\n|   2.0|2028622|\n|   2.5|1685386|\n|   3.0|6054990|\n|   3.5|4290105|\n|   4.0|8367654|\n|   4.5|2974000|\n|   5.0|4596577|\n+------+-------+\n\n\u001b[1m\u001b[34mrating_distribution\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [rating: double, count: bigint]\n"}]},"apps":[],"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":[{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=18"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=19"}],"interpreterSettingId":"spark"}},"progressUpdateIntervalMs":500,"jobName":"paragraph_1758879629018_464899813","id":"paragraph_1758879629018_464899813","dateCreated":"2025-09-26T09:40:29+0000","dateStarted":"2025-09-29T17:37:39+0000","dateFinished":"2025-09-29T17:37:52+0000","status":"FINISHED"},{"text":"// users with ≥ N ratings\r\nval ratings_per_user = ratings_with_date\r\n    .groupBy(\"userId\")\r\n    .count()\r\n    \r\ndef users_with_N_ratings(N: Int): DataFrame = {\r\n    val returnDf = ratings_per_user.where($\"count\" >= N).orderBy(asc(\"count\"))\r\n    returnDf\r\n}\r\nusers_with_N_ratings(19).show(5)","user":"anonymous","dateUpdated":"2025-09-29T17:37:52+0000","progress":0,"config":{"colWidth":12,"fontSize":9,"results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------+-----+\n|userId|count|\n+------+-----+\n|135976|   20|\n|163294|   20|\n|133590|   20|\n|181539|   20|\n|130557|   20|\n+------+-----+\nonly showing top 5 rows\n\n\u001b[1m\u001b[34mratings_per_user\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [userId: int, count: bigint]\n\u001b[1m\u001b[34musers_with_N_ratings\u001b[0m: \u001b[1m\u001b[32m(N: Int)org.apache.spark.sql.DataFrame\u001b[0m\n"}]},"apps":[],"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":[{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=20"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=21"}],"interpreterSettingId":"spark"}},"progressUpdateIntervalMs":500,"jobName":"paragraph_1758718958067_1473572017","id":"paragraph_1758651640980_464729385","dateCreated":"2025-09-24T13:02:38+0000","dateStarted":"2025-09-29T17:37:52+0000","dateFinished":"2025-09-29T17:38:03+0000","status":"FINISHED"},{"text":"// Top movies by rating count (min 100 ratings)\r\nval ratings_with_count_per_movie = ratings.groupBy(\"movieId\").count()\r\nval join_ex1 = movies.col(\"movieId\") === ratings_with_count_per_movie.col(\"movieId\")\r\nval movies_with_rating_count = movies.join(ratings_with_count_per_movie, join_ex1)\r\n    .where($\"count\" >= 100)\r\n    .select(movies(\"movieId\"), movies(\"title\"), movies(\"genres\"), ratings_with_count_per_movie(\"count\"))\r\n    .orderBy(desc(\"count\"))\r\n\r\nmovies_with_rating_count.show(5)","user":"anonymous","dateUpdated":"2025-09-29T17:38:03+0000","progress":0,"config":{"colWidth":12,"fontSize":9,"results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+--------------------+--------------------+------+\n|movieId|               title|              genres| count|\n+-------+--------------------+--------------------+------+\n|    318|Shawshank Redempt...|         Crime|Drama|102929|\n|    356| Forrest Gump (1994)|Comedy|Drama|Roma...|100296|\n|    296| Pulp Fiction (1994)|Comedy|Crime|Dram...| 98409|\n|   2571|  Matrix, The (1999)|Action|Sci-Fi|Thr...| 93808|\n|    593|Silence of the La...|Crime|Horror|Thri...| 90330|\n+-------+--------------------+--------------------+------+\nonly showing top 5 rows\n\n\u001b[1m\u001b[34mratings_with_count_per_movie\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [movieId: int, count: bigint]\n\u001b[1m\u001b[34mjoin_ex1\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Column\u001b[0m = (movieId = movieId)\n\u001b[1m\u001b[34mmovies_with_rating_count\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [movieId: int, title: string ... 2 more fields]\n"}]},"apps":[],"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":[{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=22"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=23"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=24"}],"interpreterSettingId":"spark"}},"progressUpdateIntervalMs":500,"jobName":"paragraph_1758881996950_1685138731","id":"paragraph_1758881996950_1685138731","dateCreated":"2025-09-26T10:19:56+0000","dateStarted":"2025-09-29T17:38:03+0000","dateFinished":"2025-09-29T17:38:15+0000","status":"FINISHED"},{"text":"// top-20 table with both averages and the Bayesian score\r\nval ratings_with_avg = ratings_with_date.groupBy(\"movieId\")\r\n    .agg(\r\n        format_number(avg(\"rating\"), 2).as(\"avg_rating\"),\r\n        count(\"rating\").as(\"rating_count\")\r\n    )\r\n\r\nval global_avg_rating = ratings_with_date.select(avg(\"rating\")).first()\r\nval ratings_bay_score = ratings_with_avg\r\n    .withColumn(\"bayesian_rating\", format_number((($\"rating_count\" / ($\"rating_count\" + 100)) * $\"avg_rating\") + (lit(100) / ($\"rating_count\" + 100)) * global_avg_rating(0),2))\r\nval join_ex2 = movies.col(\"movieId\") === ratings_bay_score.col(\"movieId\")\r\nval movies_with_rating = movies.join(ratings_bay_score, join_ex2).where($\"rating_count\" >= 100)\r\n    .select(movies(\"movieId\"), movies(\"title\"), movies(\"genres\"), ratings_bay_score(\"rating_count\"), ratings_bay_score(\"avg_rating\"), ratings_bay_score(\"bayesian_rating\"))\r\n    .orderBy($\"avg_rating\".desc, $\"bayesian_rating\".desc)\r\n    .limit(20)\r\nmovies_with_rating.show(30)","user":"anonymous","dateUpdated":"2025-09-29T17:38:15+0000","progress":36,"config":{"colWidth":12,"fontSize":9,"results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+--------------------+--------------------+------------+----------+---------------+\n|movieId|               title|              genres|rating_count|avg_rating|bayesian_rating|\n+-------+--------------------+--------------------+------------+----------+---------------+\n| 171011|Planet Earth II (...|         Documentary|        1956|      4.45|           4.41|\n| 159817| Planet Earth (2006)|         Documentary|        2948|      4.44|           4.41|\n| 170705|Band of Brothers ...|    Action|Drama|War|        2811|      4.43|           4.40|\n|    318|Shawshank Redempt...|         Crime|Drama|      102929|      4.40|           4.40|\n| 171495|              Cosmos|  (no genres listed)|         615|      4.33|           4.22|\n|    858|Godfather, The (1...|         Crime|Drama|       66440|      4.32|           4.32|\n| 202439|     Parasite (2019)|        Comedy|Drama|       11670|      4.31|           4.30|\n| 179135|Blue Planet II (2...|         Documentary|        1163|      4.30|           4.24|\n| 198185|   Twin Peaks (1989)|       Drama|Mystery|        1140|      4.30|           4.24|\n| 220528|Twelve Angry Men ...|               Drama|         449|      4.29|           4.15|\n|   1203| 12 Angry Men (1957)|               Drama|       21863|      4.27|           4.27|\n|     50|Usual Suspects, T...|Crime|Mystery|Thr...|       67750|      4.27|           4.27|\n|   1221|Godfather: Part I...|         Crime|Drama|       43111|      4.26|           4.26|\n| 163809|Over the Garden W...|Adventure|Animati...|        1397|      4.26|           4.21|\n|   2019|Seven Samurai (Sh...|Action|Adventure|...|       16531|      4.25|           4.25|\n| 142115|The Blue Planet (...|         Documentary|        1061|      4.25|           4.19|\n| 182723|Cosmos: A Spaceti...|  (no genres listed)|         594|      4.25|           4.15|\n|    527|Schindler's List ...|           Drama|War|       73849|      4.24|           4.24|\n| 166024|     Whiplash (2013)|  (no genres listed)|        3080|      4.24|           4.22|\n|    904|  Rear Window (1954)|    Mystery|Thriller|       24883|      4.23|           4.23|\n+-------+--------------------+--------------------+------------+----------+---------------+\n\n\u001b[1m\u001b[34mratings_with_avg\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [movieId: int, avg_rating: string ... 1 more field]\n\u001b[1m\u001b[34mglobal_avg_rating\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Row\u001b[0m = [3.5403956487277393]\n\u001b[1m\u001b[34mratings_bay_score\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [movieId: int, avg_rating: string ... 2 more fields]\n\u001b[1m\u001b[34mjoin_ex2\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Column\u001b[0m = (movieId = movieId)\n\u001b[1m\u001b[34mmovies_with_rating\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [movieId: int, title: string ... 4 more fields]\n"}]},"apps":[],"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":[{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=25"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=26"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=27"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=28"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=29"}],"interpreterSettingId":"spark"}},"progressUpdateIntervalMs":500,"jobName":"paragraph_1758718958067_300035462","id":"paragraph_1758652145500_1110142296","dateCreated":"2025-09-24T13:02:38+0000","dateStarted":"2025-09-29T17:38:15+0000","dateFinished":"2025-09-29T17:38:40+0000","status":"FINISHED"},{"text":"// For each movieId, count how often each tag appears\r\nval tags_with_count = tags.groupBy(\"movieId\", \"tag\").count()\r\ntags_with_count.show(5)","user":"anonymous","dateUpdated":"2025-09-29T17:38:40+0000","progress":100,"config":{"colWidth":12,"fontSize":9,"results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+--------------------+-----+\n|movieId|                 tag|count|\n+-------+--------------------+-----+\n|   3108| standing on a table|    1|\n|   3147|overhead camera shot|    1|\n|   3152|        diving board|    1|\n|   3152|       female nudity|    1|\n|   3152|          wristwatch|    1|\n+-------+--------------------+-----+\nonly showing top 5 rows\n\n\u001b[1m\u001b[34mtags_with_count\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [movieId: int, tag: string ... 1 more field]\n"}]},"apps":[],"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":[{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=30"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=31"}],"interpreterSettingId":"spark"}},"progressUpdateIntervalMs":500,"jobName":"paragraph_1758886649149_1449499221","id":"paragraph_1758886649149_1449499221","dateCreated":"2025-09-26T11:37:29+0000","dateStarted":"2025-09-29T17:38:40+0000","dateFinished":"2025-09-29T17:38:43+0000","status":"FINISHED"},{"text":"import scala.math._\r\n// top tags per movie (min tag frequency)\r\nval total_movies = movies.count().toDouble\r\nval movies_with_tag = tags.groupBy(\"movieId\").count().count().toDouble\r\nval top_tags = tags_with_count.withColumn(\"min_tag_freq\", format_number($\"count\" * (log10(total_movies / movies_with_tag)),2))\r\n    .orderBy(desc(\"count\"))\r\n\r\ntop_tags.show(5)","user":"anonymous","dateUpdated":"2025-09-29T17:38:43+0000","progress":0,"config":{"colWidth":12,"fontSize":9,"results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+-----------------+-----+------------+\n|movieId|              tag|count|min_tag_freq|\n+-------+-----------------+-----+------------+\n|    260|           sci-fi|  596|      138.34|\n|  79132|alternate reality|  360|       83.56|\n|    296|Quentin Tarantino|  355|       82.40|\n|   2959|     twist ending|  347|       80.54|\n|  79132|thought-provoking|  339|       78.69|\n+-------+-----------------+-----+------------+\nonly showing top 5 rows\n\nimport scala.math._\n\u001b[1m\u001b[34mtotal_movies\u001b[0m: \u001b[1m\u001b[32mDouble\u001b[0m = 87585.0\n\u001b[1m\u001b[34mmovies_with_tag\u001b[0m: \u001b[1m\u001b[32mDouble\u001b[0m = 51323.0\n\u001b[1m\u001b[34mtop_tags\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [movieId: int, tag: string ... 2 more fields]\n"}]},"apps":[],"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":[{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=32"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=33"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=34"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=35"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=36"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=37"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=38"}],"interpreterSettingId":"spark"}},"progressUpdateIntervalMs":500,"jobName":"paragraph_1758718997570_112640948","id":"paragraph_1758718997570_112640948","dateCreated":"2025-09-24T13:03:17+0000","dateStarted":"2025-09-29T17:38:43+0000","dateFinished":"2025-09-29T17:38:48+0000","status":"FINISHED"},{"text":"import org.apache.spark.sql.functions._\r\n// Per-user: first/last rating date\r\nval user_first_last = ratings_with_date.groupBy($\"userId\")\r\n    .agg(\r\n        min($\"rating_date\").as(\"first\"),\r\n        max($\"rating_date\").as(\"last\")\r\n    )    \r\n\r\nuser_first_last.show(5)","user":"anonymous","dateUpdated":"2025-09-29T17:38:48+0000","progress":100,"config":{"colWidth":12,"fontSize":9,"results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------+----------+----------+\n|userId|     first|      last|\n+------+----------+----------+\n| 93948|2000-07-05|2000-07-05|\n| 94265|2000-11-08|2000-11-08|\n| 94377|2004-02-04|2006-02-15|\n| 94695|2001-07-29|2001-08-03|\n| 94819|1996-10-19|1996-10-19|\n+------+----------+----------+\nonly showing top 5 rows\n\nimport org.apache.spark.sql.functions._\n\u001b[1m\u001b[34muser_first_last\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.DataFrame\u001b[0m = [userId: int, first: date ... 1 more field]\n"}]},"apps":[],"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":[{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=39"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=40"}],"interpreterSettingId":"spark"}},"progressUpdateIntervalMs":500,"jobName":"paragraph_1758718958068_864657507","id":"paragraph_1758704027388_26181558","dateCreated":"2025-09-24T13:02:38+0000","dateStarted":"2025-09-29T17:38:48+0000","dateFinished":"2025-09-29T17:39:03+0000","status":"FINISHED"},{"text":"// Per-user: monthly activity\r\nval monthly_activity = ratings_with_date\r\n    .withColumn(\"month\", date_format($\"rating_date\", \"yyyy-MM\"))\r\n    .groupBy($\"userId\", $\"month\")\r\n    .count()\r\n    .orderBy($\"userId\", $\"month\")\r\nmonthly_activity.show()","user":"anonymous","dateUpdated":"2025-09-29T17:47:13+0000","progress":0,"config":{"colWidth":12,"fontSize":9,"results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------+-------+-----+\n|userId|  month|count|\n+------+-------+-----+\n|     1|1999-11|   60|\n|     1|1999-12|   81|\n|     2|1996-07|   52|\n|     3|2004-05|  147|\n|     4|2000-06|   27|\n|     5|1996-08|   33|\n|     6|2004-11|   26|\n|     7|1996-08|   44|\n|     8|2019-03|   31|\n|     9|2006-01|   23|\n|     9|2006-02|   18|\n|     9|2006-03|   17|\n|    10|2007-01|  175|\n|    10|2007-02|   15|\n|    10|2007-03|    8|\n|    10|2007-04|   14|\n|    10|2007-05|    5|\n|    10|2007-06|    2|\n|    10|2007-07|    8|\n|    10|2007-08|    2|\n+------+-------+-----+\nonly showing top 20 rows\n\n\u001b[1m\u001b[34mmonthly_activity\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [userId: int, month: string ... 1 more field]\n"}]},"apps":[],"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":[{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=62"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=63"}],"interpreterSettingId":"spark"}},"progressUpdateIntervalMs":500,"jobName":"paragraph_1758875689244_1897791266","id":"paragraph_1758875689244_1897791266","dateCreated":"2025-09-26T08:34:49+0000","dateStarted":"2025-09-29T17:45:28+0000","dateFinished":"2025-09-29T17:45:46+0000","status":"FINISHED","focus":false},{"text":"//rolling 3-month count (window over time).\r\nval win = Window\r\n    .partitionBy($\"userId\")\r\n    .orderBy($\"month\")\r\n    .rowsBetween(-2, 0)\r\n\r\nval monthly_activity_with_rolling_avg = monthly_activity.withColumn(\"rolling_3_month_count\", sum($\"count\").over(win)).orderBy($\"userId\")\r\n\r\nmonthly_activity_with_rolling_avg.show()","user":"anonymous","dateUpdated":"2025-09-29T20:13:35+0000","progress":0,"config":{"colWidth":12,"fontSize":9,"results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------+-------+-----+---------------------+\n|userId|  month|count|rolling_3_month_count|\n+------+-------+-----+---------------------+\n|     1|1999-11|   60|                   60|\n|     1|1999-12|   81|                  141|\n|     2|1996-07|   52|                   52|\n|     3|2004-05|  147|                  147|\n|     4|2000-06|   27|                   27|\n|     5|1996-08|   33|                   33|\n|     6|2004-11|   26|                   26|\n|     7|1996-08|   44|                   44|\n|     8|2019-03|   31|                   31|\n|     9|2006-01|   23|                   23|\n|     9|2006-02|   18|                   41|\n|     9|2006-03|   17|                   58|\n|    10|2007-01|  175|                  175|\n|    10|2007-02|   15|                  190|\n|    10|2007-03|    8|                  198|\n|    10|2007-04|   14|                   37|\n|    10|2007-05|    5|                   27|\n|    10|2007-06|    2|                   21|\n|    10|2007-07|    8|                   15|\n|    10|2007-08|    2|                   12|\n+------+-------+-----+---------------------+\nonly showing top 20 rows\n\n\u001b[1m\u001b[34mwin\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.expressions.WindowSpec\u001b[0m = org.apache.spark.sql.expressions.WindowSpec@f44ff84\n\u001b[1m\u001b[34mmonthly_activity_with_rolling_avg\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [userId: int, month: string ... 2 more fields]\n"}]},"apps":[],"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":[{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=121"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=122"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=123"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=124"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=125"}],"interpreterSettingId":"spark"}},"progressUpdateIntervalMs":500,"jobName":"paragraph_1758870007016_1602582137","id":"paragraph_1758870007016_1602582137","dateCreated":"2025-09-26T07:00:07+0000","dateStarted":"2025-09-29T20:12:43+0000","dateFinished":"2025-09-29T20:13:02+0000","status":"FINISHED","focus":false},{"text":"// kode for Cohorts by first-rating month.\r\nval cohort_first = user_first_last\r\n    .withColumn(\"first_month\", date_format($\"first\", \"yyyy-MM\"))\r\n    .groupBy($\"first_month\").count().orderBy($\"first_month\")\r\ncohort_first.show(5)","user":"anonymous","dateUpdated":"2025-09-29T17:39:22+0000","progress":22,"config":{"colWidth":12,"fontSize":9,"results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------+-----+\n|first_month|count|\n+-----------+-----+\n|    1995-01|    2|\n|    1996-01|    6|\n|    1996-02|   20|\n|    1996-03|  226|\n|    1996-04| 1215|\n+-----------+-----+\nonly showing top 5 rows\n\n\u001b[1m\u001b[34mcohort_first\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [first_month: string, count: bigint]\n"}]},"apps":[],"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":[{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=43"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=44"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=45"}],"interpreterSettingId":"spark"}},"progressUpdateIntervalMs":500,"jobName":"paragraph_1758718958068_588507549","id":"paragraph_1758706284928_1081684833","dateCreated":"2025-09-24T13:02:38+0000","dateStarted":"2025-09-29T17:39:22+0000","dateFinished":"2025-09-29T17:39:38+0000","status":"FINISHED","focus":false},{"text":"// kode for retention = share of users active in month +1,+2, +3.\r\nval retention = user_first_last\r\n    .withColumn(\"months_activ\", months_between($\"last\", $\"first\")\r\n    .cast(IntegerType))\r\n    .where($\"months_activ\" > 0)\r\n    .groupBy($\"months_activ\")    \r\n    .count()    \r\n    .orderBy(asc(\"months_activ\"))\r\n\r\nval mon1 = retention.where($\"months_activ\" > 0).agg(sum($\"count\")).first().getLong(0)\r\nval mon2 = retention.where($\"months_activ\" > 1).agg(sum($\"count\")).first().getLong(0)\r\nval mon3 = retention.where($\"months_activ\" > 2).agg(sum($\"count\")).first().getLong(0)\r\n\r\nprintln(s\"Users activ after +1 month: $mon1, +2 months: $mon3, +3months: $mon3\")","user":"anonymous","dateUpdated":"2025-09-29T17:39:38+0000","progress":0,"config":{"colWidth":12,"fontSize":9,"results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Users activ after +1 month: 55266, +2 months: 44897, +3months: 44897\n\u001b[1m\u001b[34mretention\u001b[0m: \u001b[1m\u001b[32morg.apache.spark.sql.Dataset[org.apache.spark.sql.Row]\u001b[0m = [months_activ: int, count: bigint]\n\u001b[1m\u001b[34mmon1\u001b[0m: \u001b[1m\u001b[32mLong\u001b[0m = 55266\n\u001b[1m\u001b[34mmon2\u001b[0m: \u001b[1m\u001b[32mLong\u001b[0m = 49033\n\u001b[1m\u001b[34mmon3\u001b[0m: \u001b[1m\u001b[32mLong\u001b[0m = 44897\n"}]},"apps":[],"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":[{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=46"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=47"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=48"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=49"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=50"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=51"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=52"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=53"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=54"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=55"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=56"},{"jobUrl":"http://25e4e1c8765d:4040/jobs/job?id=57"}],"interpreterSettingId":"spark"}},"progressUpdateIntervalMs":500,"jobName":"paragraph_1758869201790_292377710","id":"paragraph_1758869201790_292377710","dateCreated":"2025-09-26T06:46:41+0000","dateStarted":"2025-09-29T17:39:38+0000","dateFinished":"2025-09-29T17:40:25+0000","status":"FINISHED"}],"name":"Movielens2","id":"2M7XKCESW","defaultInterpreterGroup":"spark","version":"0.12.0","noteParams":{},"noteForms":{},"angularObjects":{},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{},"path":"/Movielens2"}